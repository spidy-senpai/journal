<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Diary Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;family=Merriweather:wght@300;400;700&amp;family=Roboto:wght@300;400;500;700&amp;family=Playfair+Display:wght@400;500;600;700&amp;family=Lora:wght@400;500;600;700&amp;family=Montserrat:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
<style>
        :root {
            --bg-primary: #0d0d0d;
            --bg-secondary: #171717;
            --bg-tertiary: #262626;
            --border-color: #2a2a2a;
            --text-primary: #e5e5e5;
            --text-secondary: #a3a3a3;
            --text-tertiary: #737373;
            --accent: #ffffff;
            --danger: #dc2626;
            --success: #10b981;
            --warning: #f59e0b;
            --editor-font: 'Inter';
            --editor-font-size: 16px;
            --editor-font-color: #e5e5e5;
        }

        [data-theme="light"] {
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-tertiary: #f3f4f6;
            --border-color: #e5e7eb;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --text-tertiary: #9ca3af;
            --accent: #000000;
            --editor-font-color: #111827;
        }

        [data-theme="sepia"] {
            --bg-primary: #f4ecd8;
            --bg-secondary: #ece2c8;
            --bg-tertiary: #e4d9bf;
            --border-color: #d4c5a9;
            --text-primary: #5c4a3a;
            --text-secondary: #8b7355;
            --text-tertiary: #a68968;
            --accent: #5c4a3a;
            --editor-font-color: #5c4a3a;
        }

        [data-theme="blue"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --border-color: #475569;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-tertiary: #94a3b8;
            --accent: #60a5fa;
            --editor-font-color: #f1f5f9;
        }

        [data-theme="green"] {
            --bg-primary: #064e3b;
            --bg-secondary: #065f46;
            --bg-tertiary: #047857;
            --border-color: #059669;
            --text-primary: #d1fae5;
            --text-secondary: #a7f3d0;
            --text-tertiary: #6ee7b7;
            --accent: #34d399;
            --editor-font-color: #d1fae5;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
            position: relative;
        }

        .sidebar {
            width: 260px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: fixed;
            height: 100vh;
            z-index: 100;
            left: 0;
            top: 0;
        }

        .sidebar.collapsed {
            transform: translateX(-260px);
        }

        .sidebar-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 1rem;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: var(--accent);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #000;
            font-size: 0.85rem;
        }

        .new-entry-btn {
            width: 100%;
            background: var(--accent);
            border: none;
            color: var(--bg-primary);
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s ease;
            font-size: 0.875rem;
            margin-top: 12px;
        }

        .new-entry-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .nav-section {
            flex: 1;
            padding: 12px 8px;
            overflow-y: auto;
        }

        .nav-item {
            padding: 10px 12px;
            margin: 2px 0;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-secondary);
            transition: all 0.15s ease;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .nav-item:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .sidebar-footer {
            padding: 12px;
            border-top: 1px solid var(--border-color);
        }

        .profile-section {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .profile-section:hover {
            background: var(--bg-tertiary);
        }

        .profile-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.8rem;
            color: white;
        }

        .profile-info {
            flex: 1;
            min-width: 0;
        }

        .profile-name {
            font-weight: 500;
            font-size: 0.875rem;
            color: var(--text-primary);
        }

        .profile-email {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
            min-width: 0;
            margin-left: 260px;
            transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .main-content.expanded {
            margin-left: 0;
        }

        .top-bar {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .toggle-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.2s ease;
        }

        .toggle-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .page-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .top-bar-stats {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            padding: 6px 12px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .stat-item:hover {
            color: var(--text-primary);
        }

        .stat-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            justify-content: center;
            position: relative;
        }

        .editor-container {
            max-width: 720px;
            width: 100%;
        }

        .entry-header {
            margin-bottom: 32px;
            animation: fadeInUp 0.4s ease;
        }

        .title-input {
            width: 100%;
            font-size: 2.5rem;
            font-weight: 700;
            border: none;
            background: transparent;
            color: var(--editor-font-color);
            padding: 0;
            outline: none;
            margin-bottom: 8px;
            font-family: var(--editor-font), sans-serif;
        }

        .title-input::placeholder {
            color: #404040;
        }

        .meta-info {
            display: flex;
            gap: 16px;
            font-size: 0.8rem;
            color: var(--text-tertiary);
            font-weight: 500;
            flex-wrap: wrap;
        }

        .content-blocks {
            margin-bottom: 24px;
        }

        .content-block {
            background: transparent;
            margin-bottom: 20px;
            animation: fadeInUp 0.3s ease;
            position: relative;
            padding: 16px 0;
        }

        .content-block:hover .block-actions {
            opacity: 1;
        }

        .block-wrapper {
            position: relative;
        }

        .block-actions {
            position: absolute;
            right: 0;
            top: 0;
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: 10;
        }

        .block-action-btn {
            width: 32px;
            height: 32px;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-tertiary);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 1rem;
        }

        .block-action-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-color: #404040;
        }

        .block-action-btn.delete:hover {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        .text-block textarea {
            width: 100%;
            min-height: 60px;
            border: none;
            background: transparent;
            color: var(--editor-font-color);
            padding: 8px 0;
            font-size: var(--editor-font-size);
            font-family: var(--editor-font), sans-serif;
            resize: none;
            outline: none;
            line-height: 1.6;
        }

        .text-block textarea::placeholder {
            color: #404040;
        }

        .text-block textarea:focus {
            background: rgba(255, 255, 255, 0.02);
            padding: 8px 12px;
            border-radius: 6px;
        }

        .text-block textarea::selection {
            background: var(--warning);
            color: #000;
        }

        .highlighted {
            background: var(--warning);
            color: #000;
            padding: 2px 4px;
            border-radius: 2px;
        }

        .media-container {
            margin: 12px 0;
        }

        .media-preview {
            max-width: 100%;
            border-radius: 8px;
            display: block;
            border: 1px solid var(--border-color);
        }

        .video-preview {
            width: 100%;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .audio-preview {
            width: 100%;
            height: 40px;
        }

        .document-preview {
            padding: 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .document-icon {
            width: 40px;
            height: 40px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
        }

        .document-info {
            flex: 1;
        }

        .document-name {
            font-size: 0.875rem;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .document-size {
            font-size: 0.75rem;
            color: var(--text-tertiary);
        }

        .caption-input {
            width: 100%;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            padding: 8px 0;
            margin-top: 8px;
            font-size: 0.875rem;
            outline: none;
            font-style: italic;
        }

        .caption-input::placeholder {
            color: #404040;
        }

        .caption-input:focus {
            color: var(--text-primary);
        }

        .sticker-block {
            text-align: center;
            padding: 20px;
            transition: transform 0.2s ease;
        }

        .sticker-block img {
            max-width: 200px;
            height: auto;
        }

        .entry-background {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 0;
            opacity: 0.15;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            pointer-events: none;
        }

        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 16px 0;
            border-top: 1px solid var(--border-color);
            margin-top: 24px;
            animation: fadeInUp 0.5s ease;
        }

        .toolbar-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 8px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .toolbar-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-color: #404040;
        }

        .toolbar-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .submit-btn {
            width: 100%;
            background: var(--accent);
            border: none;
            color: var(--bg-primary);
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 16px;
            transition: all 0.2s ease;
        }

        .submit-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .recording-indicator {
            display: none;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: rgba(220, 38, 38, 0.1);
            border: 1px solid rgba(220, 38, 38, 0.3);
            border-radius: 8px;
            margin: 16px 0;
            animation: fadeInUp 0.3s ease;
        }

        .recording-indicator.active {
            display: flex;
        }

        .recording-dot {
            width: 10px;
            height: 10px;
            background: var(--danger);
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        .recording-time {
            color: var(--danger);
            font-weight: 600;
            font-size: 0.875rem;
        }

        .stop-recording-btn {
            margin-left: auto;
            padding: 6px 12px;
            background: var(--danger);
            border: none;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .stop-recording-btn:hover {
            background: #b91c1c;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: fadeInUp 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.5rem;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .font-option {
            padding: 12px;
            margin: 8px 0;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .font-option:hover {
            border-color: var(--accent);
        }

        .font-option.active {
            border-color: var(--accent);
            background: rgba(255, 255, 255, 0.05);
        }

        .font-controls {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .font-control-group {
            flex: 1;
        }

        .font-control-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .font-size-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .font-size-btn {
            width: 32px;
            height: 32px;
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .font-size-btn:hover {
            background: var(--bg-primary);
        }

        .font-size-display {
            flex: 1;
            text-align: center;
            color: var(--text-primary);
            font-weight: 600;
        }

        .color-picker-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-picker {
            width: 40px;
            height: 32px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            background: var(--bg-tertiary);
        }

        .color-value {
            flex: 1;
            padding: 8px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.875rem;
            text-align: center;
        }

        .sticker-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            max-height: 400px;
            overflow-y: auto;
        }

        .sticker-item {
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            overflow: hidden;
        }

        .sticker-item img {
            width: 100%;
            height: auto;
            max-width: 80px;
        }

        .sticker-item:hover {
            transform: scale(1.05);
            border-color: var(--accent);
            background: rgba(255, 255, 255, 0.05);
        }

        .theme-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .theme-option {
            padding: 16px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .theme-option:hover {
            border-color: var(--accent);
        }

        .theme-option.active {
            border-color: var(--accent);
            background: rgba(255, 255, 255, 0.05);
        }

        .theme-preview {
            width: 100%;
            height: 60px;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            gap: 4px;
            padding: 8px;
        }

        .theme-preview-color {
            flex: 1;
            border-radius: 4px;
        }

        .theme-name {
            font-weight: 500;
            font-size: 0.875rem;
        }

        .bg-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .bg-tab {
            padding: 10px 16px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-weight: 500;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .bg-tab.active {
            color: var(--text-primary);
            border-bottom-color: var(--accent);
        }

        .bg-templates {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .bg-template {
            height: 100px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid var(--border-color);
            transition: all 0.2s ease;
            background-size: cover;
            background-position: center;
        }

        .bg-template:hover {
            border-color: var(--accent);
            transform: scale(1.05);
        }

        .bg-template.active {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px var(--accent);
        }

        .bg-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 32px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .bg-upload-area:hover {
            border-color: var(--accent);
            background: rgba(255, 255, 255, 0.02);
        }

        .time-capsule-form label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .time-capsule-form input {
            width: 100%;
            padding: 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.9rem;
            margin-bottom: 16px;
        }

        .time-capsule-form input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .modal-btn-primary {
            background: var(--accent);
            border: none;
            color: var(--bg-primary);
        }

        .modal-btn-primary:hover {
            opacity: 0.9;
        }

        .modal-btn-secondary {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        .modal-btn-secondary:hover {
            background: var(--bg-tertiary);
        }

        .file-input-wrapper {
            display: none;
        }

        .notification {
            position: fixed;
            top: 24px;
            right: 24px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 16px 20px;
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.875rem;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            animation: slideInRight 0.3s ease;
            z-index: 1001;
            display: none;
        }

        .notification.show {
            display: block;
        }

        .notification.success {
            border-color: var(--success);
        }

        .notification.error {
            border-color: var(--danger);
        }

        .highlight-toolbar {
            position: fixed;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px;
            display: none;
            gap: 4px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        .highlight-toolbar.active {
            display: flex;
        }

        .highlight-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .highlight-btn:hover {
            background: var(--warning);
            color: #000;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.5;
                transform: scale(0.95);
            }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #404040;
        }

        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
            }

            .content-area {
                padding: 16px;
            }

            .title-input {
                font-size: 2rem;
            }

            .top-bar {
                flex-direction: column;
                align-items: flex-start;
            }

            .top-bar-stats {
                margin-left: 0;
                width: 100%;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }
        }
    
/* Overlay used to close sidebar on outside tap */
.overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: transparent;
    z-index: 90;
    display: none;
}
.overlay.active { display: block; }
</style>
</head>
<body>
<div class="app-container">
<div class="entry-background" id="entryBackground"></div><div class="overlay" id="sidebarOverlay"></div>
<div class="sidebar" id="sidebar">
<div class="sidebar-header">
<div class="logo">
<div class="logo-icon">D</div>
<span>Diary</span>
</div>
<button class="new-entry-btn" onclick="resetEditor()">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<path d="M12 5v14M5 12h14"></path>
</svg>
                    New Entry
                </button>
</div>
<div class="nav-section">
<div class="nav-item active">
<svg fill="none" height="18" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="18">
<path d="M12 20h9M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
</svg>
<span>New Entry</span>
</div>
<div class="nav-item">
<svg fill="none" height="18" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="18">
<path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
<path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
</svg>
<span>Past Entries</span>
</div>
<div class="nav-item">
<svg fill="none" height="18" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="18">
<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
</svg>
<span>Chat with AI</span>
</div>
</div>
<div class="sidebar-footer">
<div class="profile-section">
<div class="profile-avatar">JD</div>
<div class="profile-info">
<div class="profile-name">John Doe</div>
<div class="profile-email">john@example.com</div>
</div>
<svg fill="none" height="18" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="18">
<circle cx="12" cy="12" r="3"></circle>
<path d="M12 1v6m0 6v6m-9-9h6m6 0h6"></path>
</svg>
</div>
</div>
</div>
<div class="main-content" id="mainContent">
<div class="top-bar">
<button class="toggle-btn" onclick="toggleSidebar()">
<svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="20">
<path d="M3 12h18M3 6h18M3 18h18"></path>
</svg>
</button>
<div class="page-title">New Entry</div>
<div class="top-bar-stats">
<div class="stat-item" title="Word Count">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<path d="M4 7V4h16v3M9 20h6M12 4v16"></path>
</svg>
<span class="stat-value" id="wordCount">0</span>
<span>words</span>
</div>
<div class="stat-item" onclick="openTimeCapsule()" title="Set Time Capsule">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<circle cx="12" cy="12" r="10"></circle>
<path d="M12 6v6l4 2"></path>
</svg>
<span>Time Capsule</span>
</div>
<div class="stat-item" onclick="openFontCustomizer()" title="Customize Font">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<path d="M4 7V4h16v3M9 20h6M12 4v16"></path>
</svg>
<span>Font</span>
</div>
<div class="stat-item" onclick="openThemeSelector()" title="Change Theme">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
</svg>
<span>Theme</span>
</div>
<div class="stat-item" onclick="openBackgroundSelector()" title="Customize Background">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<rect height="18" rx="2" ry="2" width="18" x="3" y="3"></rect>
<circle cx="8.5" cy="8.5" r="1.5"></circle>
<path d="m21 15-5-5L5 21"></path>
</svg>
<span>Background</span>
</div>
</div>
</div>
<div class="content-area">
<div class="editor-container">
<div class="entry-header">
<input class="title-input" id="entryTitle" placeholder="Untitled" type="text"/>
<div class="meta-info">
<div id="currentDate"></div>
<div>·</div>
<div id="currentTime"></div>
</div>
</div>
<div class="content-blocks" id="contentBlocks"></div>
<div class="recording-indicator" id="recordingIndicator">
<div class="recording-dot"></div>
<span class="recording-time" id="recordingTime">00:00</span>
<button class="stop-recording-btn" id="stopRecordBtn">Stop Recording</button>
</div>
<div class="toolbar">
<button class="toolbar-btn" id="addTextBtn">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<path d="M4 7V4h16v3M9 20h6M12 4v16"></path>
</svg>
                            Text
                        </button>
<button class="toolbar-btn" id="addAttachmentBtn">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
</svg>
                            Add Attachment
                        </button>
<button class="toolbar-btn" id="addStickerBtn">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<circle cx="12" cy="12" r="10"></circle>
<path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
<line x1="9" x2="9.01" y1="9" y2="9"></line>
<line x1="15" x2="15.01" y1="9" y2="9"></line>
</svg>
                            Stickers
                        </button>
</div>
<input accept="image/*" class="file-input-wrapper" id="imageInput" type="file"/>
<input accept="video/*" class="file-input-wrapper" id="videoInput" type="file"/>
<input accept=".pdf,.doc,.docx,.txt" class="file-input-wrapper" id="documentInput" type="file"/>
<input accept="image/*" class="file-input-wrapper" id="bgImageInput" type="file"/>
<button class="submit-btn" id="submitBtn">Save Entry</button>
</div>
</div>
</div>
</div>
<!-- Highlight Toolbar -->
<div class="highlight-toolbar" id="highlightToolbar">
<button class="highlight-btn" onclick="highlightSelection()" title="Highlight">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<path d="M9 11l3 3L22 4"></path>
<path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
</svg>
</button>
<button class="highlight-btn" onclick="removeHighlight()" title="Remove Highlight">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<line x1="18" x2="6" y1="6" y2="18"></line>
<line x1="6" x2="18" y1="6" y2="18"></line>
</svg>
</button>
</div>
<!-- ATTACHMENT MODAL -->
<div class="modal" id="attachmentModal">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title">Add Attachment</h3>
<button class="modal-close" onclick="closeAttachmentModal()">×</button>
</div>
<div class="modal-body">
<button class="toolbar-btn" onclick="selectImage()" style="width: 100%; justify-content: flex-start; margin-bottom: 8px;">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<rect height="18" rx="2" ry="2" width="18" x="3" y="3"></rect>
<circle cx="8.5" cy="8.5" r="1.5"></circle>
<path d="m21 15-5-5L5 21"></path>
</svg>
                    Photo
                </button>
<button class="toolbar-btn" onclick="selectVideo()" style="width: 100%; justify-content: flex-start; margin-bottom: 8px;">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<path d="m23 7-7 5 7 5V7zM2 3h16v18H2z"></path>
</svg>
                    Video
                </button>
<button class="toolbar-btn" onclick="selectDocument()" style="width: 100%; justify-content: flex-start; margin-bottom: 8px;">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
<path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"></path>
</svg>
                    Document
                </button>
<button class="toolbar-btn" onclick="startRecording(); closeAttachmentModal();" style="width: 100%; justify-content: flex-start;">
<svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" width="16">
<path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
<path d="M19 10v2a7 7 0 0 1-14 0v-2M12 19v4M8 23h8"></path>
</svg>
                    Voice Note
                </button>
</div>
</div>
</div>
<!-- FONT MODAL -->
<div class="modal" id="fontModal">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title">Customize Font</h3>
<button class="modal-close" onclick="closeFontModal()">×</button>
</div>
<div class="modal-body">
<div class="font-option active" data-font="Inter" onclick="changeFont('Inter')">
<div style="font-family: Inter;">Inter - Clean &amp; Modern</div>
</div>
<div class="font-option" data-font="Merriweather" onclick="changeFont('Merriweather')">
<div style="font-family: Merriweather;">Merriweather - Classic &amp; Elegant</div>
</div>
<div class="font-option" data-font="Roboto" onclick="changeFont('Roboto')">
<div style="font-family: Roboto;">Roboto - Simple &amp; Readable</div>
</div>
<div class="font-option" data-font="Playfair Display" onclick="changeFont('Playfair Display')">
<div style="font-family: 'Playfair Display';">Playfair Display - Sophisticated</div>
</div>
<div class="font-option" data-font="Lora" onclick="changeFont('Lora')">
<div style="font-family: Lora;">Lora - Warm &amp; Friendly</div>
</div>
<div class="font-option" data-font="Montserrat" onclick="changeFont('Montserrat')">
<div style="font-family: Montserrat;">Montserrat - Bold &amp; Contemporary</div>
</div>
<div class="font-controls">
<div class="font-control-group">
<label class="font-control-label">Font Size</label>
<div class="font-size-control">
<button class="font-size-btn" onclick="changeFontSize(-2)">-</button>
<div class="font-size-display" id="fontSizeDisplay">16px</div>
<button class="font-size-btn" onclick="changeFontSize(2)">+</button>
</div>
</div>
<div class="font-control-group">
<label class="font-control-label">Font Color</label>
<div class="color-picker-wrapper">
<input class="color-picker" id="fontColorPicker" onchange="changeFontColor(this.value)" type="color"/>
<div class="color-value" id="fontColorValue">#e5e5e5</div>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- STICKER MODAL -->
<div class="modal" id="stickerModal">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title">Choose a Sticker</h3>
<button class="modal-close" onclick="closeStickerModal()">×</button>
</div>
<div class="modal-body">
<div class="sticker-grid">
<div class="sticker-item" onclick="addStickerImage('https://img.icons8.com/color/200/000000/panda.png')">
<img alt="Panda" src="https://img.icons8.com/color/200/000000/panda.png"/>
</div>
<div class="sticker-item" onclick="addStickerImage('https://img.icons8.com/color/200/000000/cat.png')">
<img alt="Cat" src="https://img.icons8.com/color/200/000000/cat.png"/>
</div>
<div class="sticker-item" onclick="addStickerImage('https://img.icons8.com/color/200/000000/dog.png')">
<img alt="Dog" src="https://img.icons8.com/color/200/000000/dog.png"/>
</div>
<div class="sticker-item" onclick="addStickerImage('https://img.icons8.com/color/200/000000/heart.png')">
<img alt="Heart" src="https://img.icons8.com/color/200/000000/heart.png"/>
</div>
<div class="sticker-item" onclick="addStickerImage('https://img.icons8.com/color/200/000000/sun.png')">
<img alt="Sun" src="https://img.icons8.com/color/200/000000/sun.png"/>
</div>
<div class="sticker-item" onclick="addStickerImage('https://img.icons8.com/color/200/000000/moon-and-stars.png')">
<img alt="Moon" src="https://img.icons8.com/color/200/000000/moon-and-stars.png"/>
</div>
<div class="sticker-item" onclick="addStickerImage('https://img.icons8.com/color/200/000000/coffee.png')">
<img alt="Coffee" src="https://img.icons8.com/color/200/000000/coffee.png"/>
</div>
<div class="sticker-item" onclick="addStickerImage('https://img.icons8.com/color/200/000000/camera.png')">
<img alt="Camera" src="https://img.icons8.com/color/200/000000/camera.png"/>
</div>
</div>
</div>
</div>
</div>
<!-- THEME MODAL -->
<div class="modal" id="themeModal">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title">Choose Theme</h3>
<button class="modal-close" onclick="closeThemeModal()">×</button>
</div>
<div class="modal-body">
<div class="theme-grid">
<div class="theme-option active" data-theme="dark" onclick="changeTheme('dark')">
<div class="theme-preview" style="background: #171717;">
<div class="theme-preview-color" style="background: #0d0d0d;"></div>
<div class="theme-preview-color" style="background: #262626;"></div>
<div class="theme-preview-color" style="background: #e5e5e5;"></div>
</div>
<div class="theme-name">Dark</div>
</div>
<div class="theme-option" data-theme="light" onclick="changeTheme('light')">
<div class="theme-preview" style="background: #f9fafb;">
<div class="theme-preview-color" style="background: #ffffff;"></div>
<div class="theme-preview-color" style="background: #f3f4f6;"></div>
<div class="theme-preview-color" style="background: #111827;"></div>
</div>
<div class="theme-name">Light</div>
</div>
<div class="theme-option" data-theme="sepia" onclick="changeTheme('sepia')">
<div class="theme-preview" style="background: #ece2c8;">
<div class="theme-preview-color" style="background: #f4ecd8;"></div>
<div class="theme-preview-color" style="background: #e4d9bf;"></div>
<div class="theme-preview-color" style="background: #5c4a3a;"></div>
</div>
<div class="theme-name">Sepia</div>
</div>
<div class="theme-option" data-theme="blue" onclick="changeTheme('blue')">
<div class="theme-preview" style="background: #1e293b;">
<div class="theme-preview-color" style="background: #0f172a;"></div>
<div class="theme-preview-color" style="background: #334155;"></div>
<div class="theme-preview-color" style="background: #60a5fa;"></div>
</div>
<div class="theme-name">Ocean Blue</div>
</div>
<div class="theme-option" data-theme="green" onclick="changeTheme('green')">
<div class="theme-preview" style="background: #065f46;">
<div class="theme-preview-color" style="background: #064e3b;"></div>
<div class="theme-preview-color" style="background: #047857;"></div>
<div class="theme-preview-color" style="background: #34d399;"></div>
</div>
<div class="theme-name">Forest Green</div>
</div>
</div>
</div>
</div>
</div>
<!-- BACKGROUND MODAL -->
<div class="modal" id="backgroundModal">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title">Customize Background</h3>
<button class="modal-close" onclick="closeBackgroundModal()">×</button>
</div>
<div class="modal-body">
<div class="bg-tabs">
<button class="bg-tab active" onclick="switchBgTab('templates')">Templates</button>
<button class="bg-tab" onclick="switchBgTab('upload')">Upload</button>
</div>
<div class="bg-tab-content" id="bgTemplatesTab">
<div class="bg-templates">
<div class="bg-template" data-bg="gradient1" onclick="setBackground('gradient1', this)" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
<div class="bg-template" data-bg="gradient2" onclick="setBackground('gradient2', this)" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"></div>
<div class="bg-template" data-bg="gradient3" onclick="setBackground('gradient3', this)" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"></div>
<div class="bg-template" data-bg="gradient4" onclick="setBackground('gradient4', this)" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);"></div>
<div class="bg-template" data-bg="gradient5" onclick="setBackground('gradient5', this)" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);"></div>
<div class="bg-template" data-bg="gradient6" onclick="setBackground('gradient6', this)" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);"></div>
<div class="bg-template" data-bg="none" onclick="setBackground('none', this)" style="background: none; border: 2px solid var(--border-color);">
<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--text-secondary); font-size: 0.875rem;">
                                None</div>
</div>
</div>
</div>
<div class="bg-tab-content" id="bgUploadTab" style="display: none;">
<div class="bg-upload-area" onclick="document.getElementById('bgImageInput').click()">
<svg fill="none" height="48" stroke="currentColor" stroke-width="2" style="margin: 0 auto; color: var(--text-secondary);" viewbox="0 0 24 24" width="48">
<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
<polyline points="17 8 12 3 7 8"></polyline>
<line x1="12" x2="12" y1="3" y2="15"></line>
</svg>
<p style="color: var(--text-secondary); margin: 12px 0 0 0; font-weight: 500;">Click to upload
                            background</p>
<p style="color: var(--text-tertiary); margin-top: 8px; font-size: 0.875rem;">Supports JPG, PNG,
                            WEBP</p>
</div>
<div id="uploadedBgPreview" style="display: none; margin-top: 16px;">
<p style="color: var(--text-secondary); margin-bottom: 8px; font-size: 0.875rem;">Uploaded
                            Background:</p>
<div style="position: relative;">
<div class="bg-template active" id="uploadedBgImage" style="height: 150px;"></div>
<button onclick="clearUploadedBg()" style="position: absolute; top: 8px; right: 8px; background: var(--danger); color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 0.8rem;">Remove</button>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- TIME CAPSULE MODAL -->
<div class="modal" id="timeCapsuleModal">
<div class="modal-content">
<div class="modal-header">
<h3 class="modal-title">Set Time Capsule</h3>
<button class="modal-close" onclick="closeTimeCapsuleModal()">×</button>
</div>
<div class="modal-body">
<form class="time-capsule-form">
<label for="capsuleDate">Choose a date to receive a notification about this entry:</label>
<input id="capsuleDate" required="" type="date"/>
<p style="font-size: 0.875rem; color: var(--text-tertiary); margin-top: 8px;">
                        You'll receive a reminder on this date to revisit this diary entry.
                    </p>
</form>
</div>
<div class="modal-footer">
<button class="modal-btn modal-btn-secondary" onclick="closeTimeCapsuleModal()">Cancel</button>
<button class="modal-btn modal-btn-primary" onclick="saveTimeCapsule()">Save</button>
</div>
</div>
</div>
<div class="notification" id="notification"></div>
<script>
        let contentBlocks = [];
        let mediaRecorder;
        let audioChunks = [];
        let blockCounter = 0;
        let recordingInterval;
        let recordingSeconds = 0;
        let currentFont = 'Inter';
        let currentFontSize = 16;
        let currentFontColor = '#e5e5e5';
        let currentTheme = 'dark';
        let timeCapsuleDate = null;
        let currentBackground = 'none';

        function init() {
            updateDateTime();
            setInterval(updateDateTime, 1000);
            addTextBlock();

            document.getElementById('addTextBtn').addEventListener('click', addTextBlock);
            document.getElementById('addAttachmentBtn').addEventListener('click', openAttachmentModal);
            document.getElementById('addStickerBtn').addEventListener('click', openStickerModal);
            document.getElementById('stopRecordBtn').addEventListener('click', stopRecording);
            document.getElementById('submitBtn').addEventListener('click', submitEntry);

            document.getElementById('imageInput').addEventListener('change', handleImageUpload);
            document.getElementById('videoInput').addEventListener('change', handleVideoUpload);
            document.getElementById('documentInput').addEventListener('change', handleDocumentUpload);
            document.getElementById('bgImageInput').addEventListener('change', handleBgImageUpload);

            document.addEventListener('input', (e) => {
                if (e.target.tagName === 'TEXTAREA') {
                    e.target.style.height = 'auto';
                    e.target.style.height = e.target.scrollHeight + 'px';
                }
                if (e.target.classList.contains('title-input') || e.target.tagName === 'TEXTAREA') {
                    updateWordCount();
                }
            });

            document.addEventListener('mouseup', handleTextSelection);
            document.addEventListener('mousedown', (e) => {
                if (!e.target.closest('.highlight-toolbar')) {
                    document.getElementById('highlightToolbar').classList.remove('active');
                }
            });

            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    closeAllModals();
                }
            });
        }

        function updateDateTime() {
            const now = new Date();
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function updateWordCount() {
            let totalWords = 0;
            const title = document.getElementById('entryTitle').value;
            totalWords += title.trim().split(/\s+/).filter(word => word.length > 0).length;

            contentBlocks.forEach(block => {
                if (block.type === 'text' && block.text) {
                    totalWords += block.text.trim().split(/\s+/).filter(word => word.length > 0).length;
                }
            });

            document.getElementById('wordCount').textContent = totalWords;
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
        }

        function showNotification(message, type = 'success') {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.className = `notification ${type} show`;
            setTimeout(() => notif.classList.remove('show'), 3000);
        }

        function resetEditor() {
            document.getElementById('entryTitle').value = '';
            contentBlocks = [];
            blockCounter = 0;
            document.getElementById('contentBlocks').innerHTML = '';
            addTextBlock();
            updateWordCount();
            showNotification('New entry started');
        }

        function addTextBlock() {
            const id = blockCounter++;
            contentBlocks.push({ id, type: 'text', text: '' });
            renderBlocks();
            setTimeout(() => {
                const textarea = document.querySelector(`[data-block-id="${id}"] textarea`);
                if (textarea) textarea.focus();
            }, 100);
        }

        function handleTextSelection() {
            const selection = window.getSelection();
            const selectedText = selection.toString().trim();

            if (selectedText.length > 0) {
                const range = selection.getRangeAt(0);
                const rect = range.getBoundingClientRect();

                const toolbar = document.getElementById('highlightToolbar');
                toolbar.style.left = rect.left + (rect.width / 2) - 40 + 'px';
                toolbar.style.top = rect.top - 45 + window.scrollY + 'px';
                toolbar.classList.add('active');
            }
        }

        function highlightSelection() {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                const span = document.createElement('span');
                span.className = 'highlighted';
                span.textContent = range.toString();
                range.deleteContents();
                range.insertNode(span);
                selection.removeAllRanges();
                document.getElementById('highlightToolbar').classList.remove('active');
                showNotification('Text highlighted');
            }
        }

        function removeHighlight() {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                const container = range.commonAncestorContainer;
                let element = container.nodeType === 3 ? container.parentNode : container;

                if (element.classList && element.classList.contains('highlighted')) {
                    const text = document.createTextNode(element.textContent);
                    element.parentNode.replaceChild(text, element);
                    showNotification('Highlight removed');
                }
            }
            document.getElementById('highlightToolbar').classList.remove('active');
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                addImageBlock(file);
                event.target.value = '';
            }
            closeAttachmentModal();
        }

        function handleVideoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                addVideoBlock(file);
                event.target.value = '';
            }
            closeAttachmentModal();
        }

        function handleDocumentUpload(event) {
            const file = event.target.files[0];
            if (file) {
                addDocumentBlock(file);
                event.target.value = '';
            }
            closeAttachmentModal();
        }

        function handleBgImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];
                if (!validTypes.includes(file.type)) {
                    showNotification('Please upload a valid image file (JPG, PNG, WEBP)', 'error');
                    return;
                }

                if (file.size > 5 * 1024 * 1024) {
                    showNotification('Image size should be less than 5MB', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    const imageUrl = e.target.result;
                    const previewDiv = document.getElementById('uploadedBgPreview');
                    const previewImg = document.getElementById('uploadedBgImage');
                    previewImg.style.backgroundImage = `url(${imageUrl})`;
                    previewImg.style.backgroundSize = 'cover';
                    previewImg.style.backgroundPosition = 'center';
                    previewDiv.style.display = 'block';

                    const bgElement = document.getElementById('entryBackground');
                    bgElement.style.backgroundImage = `url(${imageUrl})`;
                    bgElement.style.background = '';
                    currentBackground = imageUrl;

                    showNotification('Custom background applied!');
                    switchBgTab('upload');
                };
                reader.readAsDataURL(file);
                event.target.value = '';
            }
        }

        function clearUploadedBg() {
            document.getElementById('uploadedBgPreview').style.display = 'none';
            document.getElementById('uploadedBgImage').style.backgroundImage = '';
            setBackground('none');
            showNotification('Background removed');
        }

        function addImageBlock(file) {
            const id = blockCounter++;
            const reader = new FileReader();
            reader.onload = (e) => {
                contentBlocks.push({
                    id,
                    type: 'image',
                    url: e.target.result,
                    file,
                    fileName: file.name,
                    caption: ''
                });
                renderBlocks();
            };
            reader.readAsDataURL(file);
        }

        function addVideoBlock(file) {
            const id = blockCounter++;
            const reader = new FileReader();
            reader.onload = (e) => {
                contentBlocks.push({
                    id,
                    type: 'video',
                    url: e.target.result,
                    file,
                    fileName: file.name,
                    caption: ''
                });
                renderBlocks();
            };
            reader.readAsDataURL(file);
        }

        function addDocumentBlock(file) {
            const id = blockCounter++;
            contentBlocks.push({
                id,
                type: 'document',
                file,
                fileName: file.name,
                fileSize: formatFileSize(file.size),
                caption: ''
            });
            renderBlocks();
        }

        function addVoiceBlock(audioBlob) {
            const id = blockCounter++;
            const reader = new FileReader();
            reader.onload = (e) => {
                contentBlocks.push({
                    id,
                    type: 'voice',
                    url: e.target.result,
                    file: audioBlob,
                    fileName: 'voice-note.webm',
                    caption: ''
                });
                renderBlocks();
            };
            reader.readAsDataURL(audioBlob);
        }

        function addStickerImage(url) {
            const id = blockCounter++;
            contentBlocks.push({
                id,
                type: 'sticker',
                url: url
            });
            renderBlocks();
            closeStickerModal();
            showNotification('Sticker added!');
        }

        function removeBlock(id) {
            contentBlocks = contentBlocks.filter(block => block.id !== id);
            if (contentBlocks.length === 0) {
                addTextBlock();
            } else {
                renderBlocks();
            }
            updateWordCount();
            showNotification('Block removed');
        }

        function updateBlockText(id, text) {
            const block = contentBlocks.find(b => b.id === id);
            if (block) {
                block.text = text;
                updateWordCount();
            }
        }

        function updateBlockCaption(id, caption) {
            const block = contentBlocks.find(b => b.id === id);
            if (block) block.caption = caption;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        function renderBlocks() {
            const container = document.getElementById('contentBlocks');
            container.innerHTML = '';

            contentBlocks.forEach(block => {
                const blockEl = document.createElement('div');
                blockEl.className = 'content-block';
                blockEl.setAttribute('data-block-id', block.id);

                const wrapper = document.createElement('div');
                wrapper.className = 'block-wrapper';

                const actions = document.createElement('div');
                actions.className = 'block-actions';
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'block-action-btn delete';
                deleteBtn.innerHTML = `
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                    </svg>
                `;
                deleteBtn.addEventListener('click', () => removeBlock(block.id));
                actions.appendChild(deleteBtn);
                wrapper.appendChild(actions);

                if (block.type === 'text') {
                    const textDiv = document.createElement('div');
                    textDiv.className = 'text-block';
                    const textarea = document.createElement('textarea');
                    textarea.placeholder = 'Start typing...';
                    textarea.value = block.text || '';
                    textarea.addEventListener('input', (e) => {
                        updateBlockText(block.id, e.target.value);
                    });
                    textDiv.appendChild(textarea);
                    wrapper.appendChild(textDiv);
                    setTimeout(() => {
                        textarea.style.height = 'auto';
                        textarea.style.height = textarea.scrollHeight + 'px';
                    }, 0);
                } else if (block.type === 'sticker') {
                    const stickerDiv = document.createElement('div');
                    stickerDiv.className = 'sticker-block';
                    const img = document.createElement('img');
                    img.src = block.url;
                    img.alt = 'Sticker';
                    stickerDiv.appendChild(img);
                    wrapper.appendChild(stickerDiv);
                } else if (block.type === 'image') {
                    const mediaDiv = document.createElement('div');
                    mediaDiv.className = 'media-container';
                    const img = document.createElement('img');
                    img.src = block.url;
                    img.className = 'media-preview';
                    img.alt = block.fileName;
                    const caption = document.createElement('input');
                    caption.type = 'text';
                    caption.className = 'caption-input';
                    caption.placeholder = 'Add a caption...';
                    caption.value = block.caption || '';
                    caption.addEventListener('input', (e) => updateBlockCaption(block.id, e.target.value));
                    mediaDiv.appendChild(img);
                    mediaDiv.appendChild(caption);
                    wrapper.appendChild(mediaDiv);
                } else if (block.type === 'video') {
                    const mediaDiv = document.createElement('div');
                    mediaDiv.className = 'media-container';
                    const video = document.createElement('video');
                    video.src = block.url;
                    video.className = 'video-preview';
                    video.controls = true;
                    const caption = document.createElement('input');
                    caption.type = 'text';
                    caption.className = 'caption-input';
                    caption.placeholder = 'Add a caption...';
                    caption.value = block.caption || '';
                    caption.addEventListener('input', (e) => updateBlockCaption(block.id, e.target.value));
                    mediaDiv.appendChild(video);
                    mediaDiv.appendChild(caption);
                    wrapper.appendChild(mediaDiv);
                } else if (block.type === 'voice') {
                    const mediaDiv = document.createElement('div');
                    mediaDiv.className = 'media-container';
                    const audio = document.createElement('audio');
                    audio.src = block.url;
                    audio.className = 'audio-preview';
                    audio.controls = true;
                    const caption = document.createElement('input');
                    caption.type = 'text';
                    caption.className = 'caption-input';
                    caption.placeholder = 'Add a note about this recording...';
                    caption.value = block.caption || '';
                    caption.addEventListener('input', (e) => updateBlockCaption(block.id, e.target.value));
                    mediaDiv.appendChild(audio);
                    mediaDiv.appendChild(caption);
                    wrapper.appendChild(mediaDiv);
                } else if (block.type === 'document') {
                    const docDiv = document.createElement('div');
                    docDiv.className = 'document-preview';
                    docDiv.innerHTML = `
                        <div class="document-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
                            </svg>
                        </div>
                        <div class="document-info">
                            <div class="document-name">${block.fileName}</div>
                            <div class="document-size">${block.fileSize}</div>
                        </div>
                    `;
                    const caption = document.createElement('input');
                    caption.type = 'text';
                    caption.className = 'caption-input';
                    caption.placeholder = 'Add a note about this document...';
                    caption.value = block.caption || '';
                    caption.addEventListener('input', (e) => updateBlockCaption(block.id, e.target.value));
                    const container = document.createElement('div');
                    container.appendChild(docDiv);
                    container.appendChild(caption);
                    wrapper.appendChild(container);
                }

                blockEl.appendChild(wrapper);
                container.appendChild(blockEl);
            });
        }

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                recordingSeconds = 0;

                mediaRecorder.addEventListener('dataavailable', event => {
                    audioChunks.push(event.data);
                });

                mediaRecorder.addEventListener('stop', () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    addVoiceBlock(audioBlob);
                    stream.getTracks().forEach(track => track.stop());
                });

                mediaRecorder.start();

                document.getElementById('recordingIndicator').classList.add('active');

                recordingInterval = setInterval(() => {
                    recordingSeconds++;
                    const minutes = Math.floor(recordingSeconds / 60);
                    const seconds = recordingSeconds % 60;
                    document.getElementById('recordingTime').textContent =
                        `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                }, 1000);

                showNotification('Recording started', 'success');
            } catch (error) {
                showNotification('Could not access microphone', 'error');
                console.error('Recording error:', error);
            }
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                clearInterval(recordingInterval);
                document.getElementById('recordingIndicator').classList.remove('active');
                recordingSeconds = 0;
                showNotification('Recording saved', 'success');
            }
        }

        function openAttachmentModal() {
            document.getElementById('attachmentModal').classList.add('active');
        }

        function closeAttachmentModal() {
            document.getElementById('attachmentModal').classList.remove('active');
        }

        function openStickerModal() {
            document.getElementById('stickerModal').classList.add('active');
        }

        function closeStickerModal() {
            document.getElementById('stickerModal').classList.remove('active');
        }

        function selectImage() {
            document.getElementById('imageInput').click();
        }

        function selectVideo() {
            document.getElementById('videoInput').click();
        }

        function selectDocument() {
            document.getElementById('documentInput').click();
        }

        function openFontCustomizer() {
            document.getElementById('fontModal').classList.add('active');
            document.querySelectorAll('.font-option').forEach(opt => {
                opt.classList.remove('active');
                if (opt.dataset.font === currentFont) {
                    opt.classList.add('active');
                }
            });
            document.getElementById('fontSizeDisplay').textContent = currentFontSize + 'px';
            document.getElementById('fontColorPicker').value = currentFontColor;
            document.getElementById('fontColorValue').textContent = currentFontColor;
        }

        function closeFontModal() {
            document.getElementById('fontModal').classList.remove('active');
        }

        function changeFont(fontName) {
            currentFont = fontName;
            document.documentElement.style.setProperty('--editor-font', fontName);
            document.querySelectorAll('.font-option').forEach(opt => {
                opt.classList.remove('active');
                if (opt.dataset.font === fontName) {
                    opt.classList.add('active');
                }
            });
            showNotification(`Font changed to ${fontName}`);
        }

        function changeFontSize(delta) {
            currentFontSize = Math.max(12, Math.min(32, currentFontSize + delta));
            document.documentElement.style.setProperty('--editor-font-size', currentFontSize + 'px');
            document.getElementById('fontSizeDisplay').textContent = currentFontSize + 'px';
            showNotification(`Font size: ${currentFontSize}px`);
        }

        function changeFontColor(color) {
            currentFontColor = color;
            document.documentElement.style.setProperty('--editor-font-color', color);
            document.getElementById('fontColorValue').textContent = color;
            showNotification('Font color changed');
        }

        function openThemeSelector() {
            document.getElementById('themeModal').classList.add('active');
            document.querySelectorAll('.theme-option').forEach(opt => {
                opt.classList.remove('active');
                if (opt.dataset.theme === currentTheme) {
                    opt.classList.add('active');
                }
            });
        }

        function closeThemeModal() {
            document.getElementById('themeModal').classList.remove('active');
        }

        function changeTheme(theme) {
            currentTheme = theme;
            document.documentElement.setAttribute('data-theme', theme);
            document.querySelectorAll('.theme-option').forEach(opt => {
                opt.classList.remove('active');
                if (opt.dataset.theme === theme) {
                    opt.classList.add('active');
                }
            });

            const themeColors = {
                'dark': '#e5e5e5',
                'light': '#111827',
                'sepia': '#5c4a3a',
                'blue': '#f1f5f9',
                'green': '#d1fae5'
            };

            if (themeColors[theme]) {
                currentFontColor = themeColors[theme];
                document.documentElement.style.setProperty('--editor-font-color', currentFontColor);
            }

            showNotification(`Theme changed to ${theme}`);
        }

        function openBackgroundSelector() {
            document.getElementById('backgroundModal').classList.add('active');
        }

        function closeBackgroundModal() {
            document.getElementById('backgroundModal').classList.remove('active');
        }

        function switchBgTab(tab) {
            document.querySelectorAll('.bg-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.bg-tab-content').forEach(c => c.style.display = 'none');

            if (tab === 'templates') {
                document.querySelectorAll('.bg-tab')[0].classList.add('active');
                document.getElementById('bgTemplatesTab').style.display = 'block';
            } else {
                document.querySelectorAll('.bg-tab')[1].classList.add('active');
                document.getElementById('bgUploadTab').style.display = 'block';
            }
        }

        
        function setBackground(bg, element) {
            currentBackground = bg;
            const bgElement = document.getElementById('entryBackground');

            // Clear active on templates
            document.querySelectorAll('.bg-template').forEach(template => {
                template.classList.remove('active');
            });

            if (element) {
                element.classList.add('active');
            } else {
                // If this function was called with a URL (from upload), mark the upload preview as active
                const uploadedPreview = document.getElementById('uploadedBgImage');
                if (uploadedPreview && (typeof bg === 'string') && (bg.startsWith('data:') || bg.startsWith('http') || bg.startsWith('blob:'))) {
                    // visually mark upload preview but don't try to add .active to non-bg-template nodelist
                    uploadedPreview.classList.add('active');
                    const templates = document.querySelectorAll('.bg-template');
                    templates.forEach(t => t.classList.remove('active'));
                }
            }

            if (bg === 'none') {
                bgElement.style.background = 'none';
                bgElement.style.backgroundImage = 'none';
                bgElement.style.opacity = '0';
                // small delay to allow transition then hide
                setTimeout(()=> bgElement.style.opacity = '0.15', 50);
                showNotification('Background removed');
            } else if (typeof bg === 'string' && bg.startsWith('gradient')) {
                const gradients = {
                    'gradient1': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    'gradient2': 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                    'gradient3': 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                    'gradient4': 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                    'gradient5': 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                    'gradient6': 'linear-gradient(135deg, #30cfd0 0%, #330867 100%)'
                };
                bgElement.style.backgroundImage = 'none';
                bgElement.style.background = gradients[bg] || gradients['gradient1'];
                bgElement.style.backgroundSize = 'cover';
                bgElement.style.backgroundPosition = 'center';
                bgElement.style.backgroundAttachment = 'fixed';
                bgElement.style.opacity = '1';
                showNotification('Background applied!');
            } else if (typeof bg === 'string' && (bg.startsWith('data:') || bg.startsWith('http') || bg.startsWith('blob:'))) {
                // treat as image url/data
                bgElement.style.backgroundImage = `url(${bg})`;
                bgElement.style.background = '';
                bgElement.style.backgroundSize = 'cover';
                bgElement.style.backgroundPosition = 'center';
                bgElement.style.backgroundAttachment = 'fixed';
                bgElement.style.opacity = '0.15';
                showNotification('Background applied!');
            } else {
                // fallback: set as css (if developer passed in a CSS gradient string)
                bgElement.style.background = bg || 'none';
                bgElement.style.backgroundImage = (bg && bg.includes('gradient')) ? 'none' : bgElement.style.backgroundImage;
                bgElement.style.opacity = '0.15';
                showNotification('Background applied!');
            }
        }
    

        function openTimeCapsule() {
            document.getElementById('timeCapsuleModal').classList.add('active');
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('capsuleDate').min = today;
            if (timeCapsuleDate) {
                document.getElementById('capsuleDate').value = timeCapsuleDate;
            }
        }

        function closeTimeCapsuleModal() {
            document.getElementById('timeCapsuleModal').classList.remove('active');
        }

        function saveTimeCapsule() {
            const date = document.getElementById('capsuleDate').value;
            if (date) {
                timeCapsuleDate = date;
                const formattedDate = new Date(date).toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric'
                });
                showNotification(`Time capsule set for ${formattedDate}`);
                closeTimeCapsuleModal();
            } else {
                showNotification('Please select a date', 'error');
            }
        }

        function closeAllModals() {
            closeAttachmentModal();
            closeFontModal();
            closeTimeCapsuleModal();
            closeStickerModal();
            closeThemeModal();
            closeBackgroundModal();
        }

        async function submitEntry() {
            const title = document.getElementById('entryTitle').value.trim();

            if (!title && contentBlocks.length === 0) {
                showNotification('Please add a title or content', 'error');
                return;
            }

            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Saving...';

            try {
                // Prepare the data to send to Python backend
                const entryData = {
                    title: title,
                    // ...
                    date: new Date().toISOString(), // Missing parentheses!
                    // ...
                    font: currentFont,
                    fontSize: currentFontSize,
                    fontColor: currentFontColor,
                    theme: currentTheme,
                    background: currentBackground,
                    timeCapsule: timeCapsuleDate,
                    blocks: contentBlocks.map(block => ({
                        id: block.id,
                        type: block.type,
                        text: block.text || '',
                        caption: block.caption || '',
                        fileName: block.fileName || '',
                        fileSize: block.fileSize || ''
                    }))
                };

                // For files, you would need to send FormData
                const formData = new FormData();
                formData.append('entry_data', JSON.stringify(entryData));

                // Add files
                contentBlocks.forEach((block, index) => {
                    if (block.file) {
                        formData.append(`file_${index}`, block.file, block.fileName);
                    }
                });

                // Send to Python backend
                const response = await fetch('/api/save-entry', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('Entry saved:', result);
                    showNotification('Entry saved successfully!', 'success');

                    setTimeout(() => {
                        resetEditor();
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Save Entry';
                    }, 1500);
                } else {
                    throw new Error('Failed to save entry');
                }
            } catch (error) {
                console.error('Error saving entry:', error);
                showNotification('Failed to save entry. Please try again.', 'error');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Save Entry';
            }
        }

        
        // --- Sidebar overlay helpers ---
        const sidebarEl = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        const overlayEl = document.getElementById('sidebarOverlay');

        function openSidebar() {
            sidebarEl.classList.remove('collapsed');
            mainContent.classList.remove('expanded');
            overlayEl.classList.add('active');
        }

        function closeSidebar() {
            sidebarEl.classList.add('collapsed');
            mainContent.classList.add('expanded');
            overlayEl.classList.remove('active');
        }

        // Toggle now uses open/close for clarity
        function toggleSidebar() {
            if (sidebarEl.classList.contains('collapsed')) {
                openSidebar();
            } else {
                closeSidebar();
            }
        }

        // Close sidebar if clicking outside of it (but not when clicking modals or their children)
        document.addEventListener('click', function (e) {
            const isClickInsideSidebar = e.target.closest('#sidebar');
            const isClickOnToggle = e.target.closest('.toggle-btn');
            const isModalOpen = document.querySelector('.modal.active');
            if (!isClickInsideSidebar && !isClickOnToggle && !isModalOpen) {
                // only close if overlay is active (i.e., sidebar open on small screens)
                if (overlayEl.classList.contains('active')) closeSidebar();
            }
        });

        // Ensure overlay click also closes sidebar
        overlayEl.addEventListener('click', function(e){ closeSidebar(); });

        window.addEventListener('DOMContentLoaded', init);
    
// --- Touch event to close sidebar ---
document.addEventListener('touchstart', function(e) {
    const isTouchInsideSidebar = e.target.closest('#sidebar');
    const isTouchOnToggle = e.target.closest('.toggle-btn');
    const isModalOpen = document.querySelector('.modal.active');
    if (!isTouchInsideSidebar && !isTouchOnToggle && !isModalOpen) {
        closeSidebar();
    }
}, { passive: true });
</script>
<script>
async function sendDiaryEntryToFlask() {
    console.log("🔹 Starting diary submission...");

    const title = document.querySelector(".title-input")?.value?.trim() || "Untitled Entry";
    const blocks = [];
    const timestamp = new Date().toISOString();
    const contentBlocks = document.querySelectorAll(".content-block");

    if (!contentBlocks.length) {
        console.warn("⚠️ No content blocks found.");
        showNotification("No content to send!", "error");
        return;
    }

    console.log(`🧱 Found ${contentBlocks.length} content blocks.`);

    contentBlocks.forEach((block, index) => {
        const textArea = block.querySelector("textarea");
        const img = block.querySelector("img");
        const video = block.querySelector("video");
        const audio = block.querySelector("audio");

        const blockData = {
            id: block.dataset.id || `block-${index}`,
            type: "text",
            content: "",
            style: {}
        };

        if (textArea) {
            const s = window.getComputedStyle(textArea);
            blockData.type = "text";
            blockData.content = textArea.value || "";
            blockData.style = {
                fontFamily: s.fontFamily,
                fontSize: s.fontSize,
                color: s.color
            };
        } 
        else if (img) {
            blockData.type = "image";
            blockData.src = img.src;
        } 
        else if (video) {
            blockData.type = "video";
            blockData.src = video.src;
        } 
        else if (audio) {
            blockData.type = "audio";
            blockData.src = audio.src;
        } 
        else {
            console.warn(`⚠️ Unknown block type at index ${index}`, block);
        }

        blocks.push(blockData);
    });

    const payload = { title, timestamp, blocks };
    console.log("📦 Payload prepared:", payload);

    try {
        const response = await fetch("http://127.0.0.1:5000/save_entry", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        console.log("📨 Response received:", response);

        if (response.ok) {
            let data;
            try {
                data = await response.json();
                console.log("✅ JSON Response:", data);
            } catch {
                console.warn("⚠️ Response not JSON, ignoring.");
            }
            showNotification("Entry saved successfully!", "success");
        } else {
            console.error("❌ Server responded with an error:", response.status);
            showNotification("Failed to save entry.", "error");
        }
    } catch (err) {
        console.error("🚨 Fetch error:", err);
        showNotification("Could not connect to Flask server.", "error");
    }
}

function showNotification(message, type = "success") {
    const n = document.createElement("div");
    n.className = `notification ${type} show`;
    n.textContent = message;
    Object.assign(n.style, {
        position: "fixed",
        top: "20px",
        right: "20px",
        padding: "12px 18px",
        borderRadius: "8px",
        background: type === "error" ? "#dc2626" : "#10b981",
        color: "#fff",
        zIndex: 9999
    });
    document.body.appendChild(n);
    setTimeout(() => n.remove(), 3000);
}

// 🔍 Ensure button exists before binding
document.addEventListener("DOMContentLoaded", () => {
    const btn = document.querySelector(".submit-btn");
    if (btn) {
        btn.addEventListener("click", sendDiaryEntryToFlask);
        console.log("✅ Submit button bound successfully.");
    } else {
        console.warn("⚠️ No .submit-btn found in the document.");
    }
});
</script>
</body>
</html>